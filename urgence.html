<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urgences - Le TrÃ©sor Public</title>
    <style>
        body { 
            font-family: 'Comic Sans MS', cursive, sans-serif; 
            background-color: #FFFF00; color: #000080; 
            margin: 0; padding: 0; text-align: center; 
        }
        .menu-table { margin: 20px auto; background-color: #008080; border-collapse: collapse; border-radius: 10px; overflow: hidden; }
        .menu-table td { padding: 12px 20px; border: 1px solid #FFFFFF; }
        .menu-table a { text-decoration: none; color: #FFFFFF; font-weight: bold; }
        
        .form-container { 
            background: white; border: 5px solid #e91e63; border-radius: 30px; 
            width: 90%; max-width: 650px; margin: 30px auto; padding: 25px;
            box-shadow: 10px 10px 0px #e91e63;
        }
        h1 { color: #e91e63; }
        label { display: block; margin-top: 15px; font-weight: bold; text-align: left; }
        input, textarea { 
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; 
            border: 2px solid #e91e63; box-sizing: border-box; font-family: inherit;
        }
        .btn-envoi { 
            background: #e91e63; color: white; border: none; padding: 18px 40px; 
            border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 1.3em; margin-top: 20px; 
        }
        .carte-alerte { 
            background: white; border-left: 10px solid #e91e63; border-radius: 15px; 
            padding: 20px; margin: 20px auto; max-width: 650px; text-align: left; 
            box-shadow: 4px 4px 10px rgba(0,0,0,0.1); 
        }
    </style>
</head>
<body>

    <table class="menu-table">
        <tr>
            <td><a href="index.html">Accueil</a></td>
            <td><a href="formulaire.html">Semer</a></td>
            <td><a href="jardin.html">Le Jardin</a></td>
            <td><a href="regulation.html">RÃ©gulation</a></td>
            <td><a href="urgence.html">Urgences</a></td>
        </tr>
    </table>

    <h1>ðŸš¨ SOS : Besoins du CÅ“ur</h1>

    <div class="form-container">
        <form id="urgencyForm">
            <input type="hidden" id="type" value="Urgence">

            <label>Ton IdentitÃ© :</label>
            <input type="text" id="nom" placeholder="Ton nom ou pseudo" required>

            <label>Ta Localisation :</label>
            <input type="text" id="ville" placeholder="Ex: PrÃ¨s du grand chÃªne" required>

            <label>Besoin de :</label>
            <textarea id="message" rows="6" 
                placeholder="Ex : J'ai faim ! J'ai ma toiture Ã  refaire, j'ai besoin de 3.5 bras voir 4 si possible ou j'ai besoin de farine pour le pain du..." 
                required></textarea>

            <button type="submit" id="btnEnvoi" class="btn-envoi">LANCER L'APPEL ðŸš€</button>
        </form>
    </div>

    <div id="flux-urgences">
        <h2 style="color: #e91e63;">ðŸ”¥ Alertes Actives</h2>
        <div id="chargement">Ã‰coute des signaux du jardin...</div>
    </div>

    <script>
        const URL_SERVEUR = "https://script.google.com/macros/s/AKfycbz4ncs9qw_AfmKSER5QST-P0OeKQggQaq86QC6liS53uZ9sx4Lo_-4-h1knXKWqgQMc/exec";

        document.getElementById('urgencyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnEnvoi');
            btn.innerText = "Envoi du SOS...";
            btn.disabled = true;

            fetch(URL_SERVEUR, { 
                method: 'POST', 
                mode: 'no-cors', 
                body: JSON.stringify({
                    date: new Date().toLocaleDateString('fr-FR'),
                    type: "Urgence",
                    nom: document.getElementById('nom').value,
                    localisation: document.getElementById('ville').value,
                    message: document.getElementById('message').value
                })
            }).then(() => {
                alert("Signal envoyÃ© ! Garde espoir, la fraternitÃ© arrive.");
                location.reload();
            });
        });

        fetch(URL_SERVEUR).then(r => r.json()).then(data => {
            const flux = document.getElementById('flux-urgences');
            document.getElementById('chargement').style.display = 'none';
            const alertes = data.filter(d => d.type === "Urgence").reverse();
            if (alertes.length === 0) {
                flux.innerHTML += "<p>Aucune urgence. Le jardin est en paix.</p>";
            } else {
                alertes.forEach(u => {
                    const div = document.createElement('div');
                    div.className = 'carte-alerte';
                    div.innerHTML = `
                        <small>${u.date}</small> - <b style="color:#e91e63">ðŸš¨ SOS</b><br>
                        <b>${u.nom}</b> Ã  ${u.localisation}<br>
                        <p style="margin-top:10px; border-top: 1px dotted #ccc; padding-top:10px;">
                            <b>Besoin de :</b> ${u.message}
                        </p>`;
                    flux.appendChild(div);
                });
            }
        });
    </script>
</body>
</html>
