<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>R√©gulation Citoyenne</title>
    <style>
        body { font-family: 'Comic Sans MS', cursive; background-color: #FFFF00; color: #000080; text-align: center; padding: 20px; }
        .menu-table { margin: 20px auto; background-color: #008080; border-collapse: collapse; border-radius: 10px; margin-left: auto; margin-right: auto; }
        .menu-table td { padding: 10px 15px; border: 1px solid #FFFFFF; }
        .menu-table a { text-decoration: none; color: #FFFFFF; font-weight: bold; }
        
        .etoile-form { 
            background: #E6E6FA; border: 3px solid #9370DB; width: 90%; max-width: 600px; 
            margin: 30px auto; padding: 30px; border-radius: 20px; box-shadow: 5px 5px 0px #9370DB;
        }
        textarea, input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 2px solid #9370DB; box-sizing: border-box; font-family: inherit; }
        .btn-justice { background: #9370DB; color: white; padding: 15px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1.1em; }
        
        .carte-conflit { background: white; border-left: 8px solid #9370DB; border-radius: 15px; padding: 15px; margin: 20px auto; max-width: 600px; text-align: left; box-shadow: 4px 4px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <table class="menu-table">
        <tr>
            <td><a href="index.html">Accueil</a></td>
            <td><a href="formulaire.html">Semer</a></td>
            <td><a href="jardin.html">Le Jardin</a></td>
            <td><a href="regulation.html">R√©gulation</a></td>
        </tr>
    </table>

    <h2 style="color:#9370DB;">‚öñÔ∏è Zone de R√©gulation Citoyenne</h2>

    <div class="etoile-form">
        <form id="regForm">
            <label>Ton identit√© amoureuse :</label>
            <input type="text" id="nom" placeholder="Ton nom ou pseudo" required>
            <label>Nature du conflit :</label>
            <textarea id="message" rows="5" placeholder="Expose ton conflit ici..." required></textarea>
            <button type="submit" id="btnEnvoi" class="btn-justice">SOUMETTRE √Ä L'ENSEMBLE üïäÔ∏è</button>
        </form>
    </div>

    <hr style="max-width:600px; border: 1px solid #9370DB;">

    <h3 style="color:#9370DB;">üïäÔ∏è Dossiers en cours de r√©solution</h3>
    <div id="chargement">Recherche de dossiers...</div>
    <div id="flux-conflits"></div>

    <br>
    <a href="index.html" style="color:#000080; font-weight:bold; text-decoration: none;">‚Üê Retour au Tr√©sor Public</a>

    <script>
        const URL_SERVEUR = "https://script.google.com/macros/s/AKfycbz4ncs9qw_AfmKSER5QST-P0OeKQggQaq86QC6liS53uZ9sx4Lo_-4-h1knXKWqgQMc/exec";

        // ENVOYER
        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();
            document.getElementById('btnEnvoi').innerText = "Transmission...";
            
            const donnees = {
                date: new Date().toLocaleDateString('fr-FR'),
                type: "Conflit",
                nom: document.getElementById('nom').value,
                localisation: "Zone de Paix",
                message: document.getElementById('message').value
            };

            fetch(URL_SERVEUR, { method: 'POST', mode: 'no-cors', body: JSON.stringify(donnees) })
            .then(() => { 
                alert("Dossier d√©pos√© !"); 
                location.reload(); 
            });
        });

        // LIRE
        fetch(URL_SERVEUR)
            .then(res => res.json())
            .then(data => {
                const chargement = document.getElementById('chargement');
                const flux = document.getElementById('flux-conflits');
                const conflits = data.filter(item => item.type === "Conflit");

                if (conflits.length === 0) {
                    chargement.innerText = "Le registre est vierge, aucune peine n'est expos√©e pour le moment.";
                } else {
                    chargement.style.display = 'none';
                    conflits.reverse().forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'carte-conflit';
                        div.innerHTML = `<b>${item.nom}</b> <small>(${item.date})</small><br><p>"${item.message}"</p>`;
                        flux.appendChild(div);
                    });
                }
            })
            .catch(() => { document.getElementById('chargement').innerText = "Connexion au registre impossible."; });
    </script>
</body>
</html>
