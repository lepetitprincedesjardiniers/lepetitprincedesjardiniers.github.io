<div class="liste-conflits">
        <h3 style="color:#9370DB;">üïäÔ∏è Dossiers en cours de r√©solution</h3>
        <div id="chargement">Appel de la sagesse citoyenne...</div>
        <div id="flux-conflits"></div>
    </div>
    
    <a href="index.html" style="color:#000080; font-weight:bold; text-decoration: none;">‚Üê Retour au Tr√©sor Public</a>

    <script>
        const URL_SERVEUR = "https://script.google.com/macros/s/AKfycbz4ncs9qw_AfmKSER5QST-P0OeKQggQaq86QC6liS53uZ9sx4Lo_-4-h1knXKWqgQMc/exec";

        // 1. ENVOI DU CONFLIT INITIAL
        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnEnvoi');
            btn.innerText = "D√©p√¥t du dossier...";
            btn.disabled = true;

            const donnees = {
                date: new Date().toLocaleDateString('fr-FR'),
                type: "Conflit",
                nom: document.getElementById('nom').value,
                localisation: "Zone de Paix",
                message: document.getElementById('message').value
            };

            fetch(URL_SERVEUR, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(donnees)
            }).then(() => {
                alert("Ton message a √©t√© confi√© √† l'ensemble.");
                location.reload();
            });
        });

        // 2. FONCTION POUR APPORTER UN AVIS (R√âPONSE)
        function apporterAvis(nomConflit) {
            const avis = prompt("En tant que tiers ou juge citoyen, quel est ton avis d√©licat pour aider √† r√©soudre ce conflit ?");
            if (avis) {
                const nomSage = prompt("Ton nom de sage :");
                const donneesAvis = {
                    date: new Date().toLocaleDateString('fr-FR'),
                    type: "Avis",
                    nom: nomSage || "Un Sage Anonyme",
                    localisation: "R√©ponse √† : " + nomConflit,
                    message: avis
                };

                fetch(URL_SERVEUR, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(donneesAvis)
                }).then(() => {
                    alert("Ton avis a √©t√© ajout√© au registre de justice.");
                    location.reload();
                });
            }
        }

        // 3. R√âCUP√âRATION ET AFFICHAGE
        fetch(URL_SERVEUR)
            .then(res => res.json())
            .then(data => {
                document.getElementById('chargement').style.display = 'none';
                const flux = document.getElementById('flux-conflits');
                
                // On inverse pour avoir le plus r√©cent en haut
                const documents = data.reverse();

                documents.forEach(item => {
                    if(item.type === "Conflit") {
                        const div = document.createElement('div');
                        div.className = 'carte-conflit';
                        div.innerHTML = `
                            <small>${item.date} - Par : ${item.nom}</small>
                            <p style="margin: 10px 0; font-weight:bold;">"${item.message}"</p>
                            <div id="reponses-${item.nom}" style="margin-left: 20px; border-left: 2px dotted #9370DB; padding-left: 10px; font-size: 0.9em;">
                                </div>
                            <span class="reponse-sage" onclick="apporterAvis('${item.nom}')">‚öñÔ∏è Apporter un avis d√©licat</span>
                        `;
                        flux.appendChild(div);

                        // On cherche les avis li√©s √† ce conflit sp√©cifique
                        documents.forEach(avis => {
                            if(avis.type === "Avis" && avis.localisation.includes(item.nom)) {
                                const repDiv = document.getElementById(`reponses-${item.nom}`);
                                const pAvis = document.createElement('p');
                                pAvis.innerHTML = `üí¨ <strong>${avis.nom} :</strong> ${avis.message}`;
                                repDiv.appendChild(pAvis);
                            }
                        });
                    }
                });
            });
    </script>
</body>
</html>
