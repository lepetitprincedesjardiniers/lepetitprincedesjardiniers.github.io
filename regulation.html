<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>R√©gulation Citoyenne - Le Petit Prince</title>
    <style>
        /* ON GARDE TON STYLE EXACT */
        body { font-family: 'Comic Sans MS', cursive; text-align: center; margin: 0; padding: 0; background-color: #FFFF00; color: #000080; }
        
        /* Ajout du menu pour la navigation */
        .menu-table { margin: 20px auto; background-color: #008080; border-collapse: collapse; border-radius: 10px; margin-left: auto; margin-right: auto; }
        .menu-table td { padding: 10px 15px; border: 1px solid #FFFFFF; }
        .menu-table a { text-decoration: none; color: #FFFFFF; font-weight: bold; }

        .etoile-form { 
            background: #E6E6FA; border: 3px solid #9370DB; width: 90%; max-width: 600px; 
            margin: 30px auto; padding: 30px; border-radius: 20px;
            box-shadow: 0px 10px 20px rgba(147, 112, 219, 0.3);
        }
        textarea, input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 2px solid #9370DB; box-sizing: border-box; font-family: inherit; }
        .btn-justice { background: #9370DB; color: white; padding: 15px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1.1em; }
        .btn-justice:disabled { background: #ccc; }

        /* Style pour la zone d'affichage des conflits */
        .liste-conflits { max-width: 700px; margin: 40px auto; padding: 20px; }
        .carte-conflit { 
            background: white; border-left: 8px solid #9370DB; border-radius: 15px; 
            padding: 20px; margin-bottom: 20px; text-align: left; 
            box-shadow: 4px 4px 10px rgba(0,0,0,0.05);
        }
        .reponse-sage { font-size: 0.8em; color: #9370DB; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <table class="menu-table">
        <tr>
            <td><a href="index.html">Accueil</a></td>
            <td><a href="formulaire.html">Semer</a></td>
            <td><a href="jardin.html">Le Jardin</a></td>
            <td><a href="regulation.html">R√©gulation</a></td>
        </tr>
    </table>

    <h2 style="color:#9370DB;">‚öñÔ∏è Zone de R√©gulation Citoyenne</h2>
    <p><i>Expose ton conflit avec sinc√©rit√©. La communaut√© r√©pondra avec d√©licatesse.</i></p>

    <div class="etoile-form">
        <form id="regForm">
            <label>Ton identit√© amoureuse :</label>
            <input type="text" id="nom" placeholder="Ton nom ou pseudo" required>
            
            <label>Nature du conflit ou de la peine :</label>
            <textarea id="message" rows="6" placeholder="Explique ici la situation..." required></textarea>
            
            <p><small>En soumettant, tu acceptes le regard bienveillant, le pardon ou la sentence symbolique de tes pairs.</small></p>
            <button type="submit" id="btnEnvoi" class="btn-justice">SOUMETTRE √Ä L'ENSEMBLE</button>
        </form>
    </div>

    <div class="liste-conflits">
        <h3 style="color:#9370DB;">üïäÔ∏è Dossiers en cours de r√©solution</h3>
        <div id="chargement">Appel de la sagesse citoyenne...</div>
        <div id="flux-conflits"></div>
    </div>
    
    <a href="index.html" style="color:#000080; font-weight:bold; text-decoration: none;">‚Üê Retour au Tr√©sor Public</a>

    <script>
        const URL_SERVEUR = "https://script.google.com/macros/s/AKfycbz4ncs9qw_AfmKSER5QST-P0OeKQggQaq86QC6liS53uZ9sx4Lo_-4-h1knXKWqgQMc/exec";

        // 1. ENVOI DU CONFLIT AU GOOGLE SHEET
        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnEnvoi');
            btn.innerText = "D√©p√¥t du dossier...";
            btn.disabled = true;

            const donnees = {
                date: new Date().toLocaleDateString('fr-FR'),
                type: "Conflit",
                nom: document.getElementById('nom').value,
                localisation: "Zone de Paix",
                message: document.getElementById('message').value
            };

            fetch(URL_SERVEUR, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(donnees)
            }).then(() => {
                alert("Ton message a √©t√© confi√© √† l'ensemble.");
                location.reload();
            });
        });

        // 2. R√âCUP√âRATION DES CONFLITS POUR LES AFFICHER
        fetch(URL_SERVEUR)
            .then(res => res.json())
            .then(data => {
                document.getElementById('chargement').style.display = 'none';
                const flux = document.getElementById('flux-conflits');
                // On ne garde que les messages de type "Conflit"
                data.reverse().forEach(item => {
                    if(item.type === "Conflit") {
                        const div = document.createElement('div');
                        div.className = 'carte-conflit';
                        div.innerHTML = `
                            <small>${item.date} - Par : ${item.nom}</small>
                            <p style="margin: 10px 0;">"${item.message}"</p>
                            <span class="reponse-sage" onclick="alert('Fonctionnalit√© de r√©ponse √† venir pour les sages...')">‚öñÔ∏è Apporter un avis d√©licat</span>
                        `;
                        flux.appendChild(div);
                    }
                });
            })
            .catch(() => {
                document.getElementById('chargement').innerText = "La justice est en repos...";
            });
    </script>
</body>
</html>
