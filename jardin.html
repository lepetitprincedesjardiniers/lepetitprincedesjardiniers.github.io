<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Le Jardin - Le Petit Prince</title>
    <style>
        body { background-color: #FFFF00; color: #000080; font-family: "Comic Sans MS", cursive; text-align: center; }
        .carte { background: white; border: 2px solid #008080; margin: 15px auto; padding: 15px; width: 85%; max-width: 600px; border-radius: 15px; text-align: left; box-shadow: 4px 4px 0px #008080; }
        .titre { color: #FF0000; font-weight: bold; font-size: 1.2em; border-bottom: 1px dashed #ccc; }
        #moteur { width: 80%; padding: 15px; font-size: 1.1em; border: 3px solid #008080; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body onload="charger()">

    <table border="1" cellpadding="10" bgcolor="#008080" align="center">
        <tr>
            <td><a href="index.html"><font color="#FFFFFF"><b>Accueil</b></font></a></td>
            <td><a href="formulaire.html"><font color="#FFFFFF"><b>Semer</b></font></a></td>
            <td><a href="jardin.html"><font color="#FFFFFF"><b>Le Jardin</b></font></a></td>
            <td><a href="contact.html"><font color="#FFFFFF"><b>Contact</b></font></a></td>
        </tr>
    </table>

    <h1>üîé RECHERCHER DANS LE JARDIN</h1>
    <input type="text" id="moteur" onkeyup="filtrer()" placeholder="Tapez une ville ou un mot (ex: tomates)...">

    <div id="status"><b>Fleurissement en cours... üåª</b></div>
    <div id="liste"></div>

    <script>
        const url = "https://script.google.com/macros/s/AKfycbwe3bMzbJMUQSEdeyprffw-FQpqLg9-fGcHJi2_1_Ix5kWmrisBoSo2Kzne-CMwe3s/exec";
        let annonces = [];

        async function charger() {
            try {
                const res = await fetch(url);
                annonces = await res.json();
                document.getElementById('status').style.display = 'none';
                afficher(annonces);
            } catch(e) { document.getElementById('status').innerText = "Le jardin est ferm√© pour le moment."; }
        }

        function afficher(data) {
            const conteneur = document.getElementById('liste');
            conteneur.innerHTML = "";
            [...data].reverse().forEach(a => {
                conteneur.innerHTML += `
                <div class="carte">
                    <span class="titre">üåø Graine de ${a.prenom}</span><br>
                    <b>üìç Ville :</b> ${a.ville} (${a.km} km autour)<br>
                    <b>üí¨ Message :</b> ${a.description}<br><br>
                    <small>Post√© le : ${new Date(a.date).toLocaleDateString()} | Dur√©e : ${a.duree}</small>
                </div>`;
            });
        }

        function filtrer() {
            const mot = document.getElementById('moteur').value.toLowerCase();
            const resultat = annonces.filter(a => 
                a.ville.toLowerCase().includes(mot) || 
                a.description.toLowerCase().includes(mot) ||
                a.prenom.toLowerCase().includes(mot)
            );
            afficher(resultat);
        }
    </script>
</body>
</html>
