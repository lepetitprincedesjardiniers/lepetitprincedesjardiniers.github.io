<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Tr√©sor Public - Dashboard Magique</title>
    <style>
        :root {
            --primary-pink: #ff4d6d;
            --menu-teal: #008080;
        }

        body { 
            font-family: 'Comic Sans MS', cursive; 
            background: radial-gradient(circle at center, #2d0a1a 0%, #050505 100%);
            color: white; 
            margin: 0; 
            text-align: center; 
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* --- INTRO COEUR --- */
        #intro-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000; transition: opacity 1s ease-out;
        }
        .heart-main {
            width: 80px; height: 80px; background-color: var(--primary-pink);
            transform: rotate(-45deg); animation: pulse 1.2s infinite; position: relative;
            box-shadow: 0 0 40px var(--primary-pink);
        }
        .heart-main::before, .heart-main::after {
            content: ""; position: absolute; width: 80px; height: 80px;
            background-color: var(--primary-pink); border-radius: 50%;
        }
        .heart-main::before { top: -40px; left: 0; }
        .heart-main::after { left: 40px; top: 0; }
        @keyframes pulse { 0%, 100% { scale: 1; } 50% { scale: 1.15; } }

        /* --- MENU & NAVIGATION --- */
        .menu-table { 
            margin: 20px auto; background-color: var(--menu-teal); 
            border-radius: 15px; overflow: hidden; border-collapse: collapse; 
            position: relative; z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .menu-table td { padding: 12px 20px; border: 1px solid rgba(255,255,255,0.3); }
        .menu-table a { text-decoration: none; color: white; font-weight: bold; }

        /* --- CONTENU --- */
        .philosophie { 
            background: rgba(255, 255, 255, 0.1); border: 2px solid var(--menu-teal); border-radius: 30px; 
            padding: 20px; margin: 20px auto; max-width: 800px; font-style: italic;
            backdrop-filter: blur(5px); box-shadow: 0 0 20px rgba(0, 128, 128, 0.2);
        }

        #searchBox { 
            width: 80%; max-width: 500px; padding: 15px; border: 3px solid var(--menu-teal); 
            border-radius: 30px; font-size: 1.1em; margin: 20px 0; background: white;
            position: relative; z-index: 100;
        }

        /* --- CARTES DE DONN√âES --- */
        .carte { 
            background: rgba(255, 255, 255, 0.95); margin: 15px auto; max-width: 700px; padding: 20px; 
            text-align: left; border-radius: 15px; border-left: 12px solid var(--menu-teal);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3); color: #000080;
            position: relative; z-index: 50;
        }

        /* --- PAPILLONS --- */
        .butterfly { position: absolute; width: 30px; height: 30px; z-index: 10; pointer-events: none; }
        .wing { fill: #ffb3c1; animation: flap 0.2s infinite; transform-origin: center; }
        @keyframes flap { 50% { transform: scaleX(0.2); } }
    </style>
</head>
<body>

    <div id="intro-layer">
        <div class="heart-main"></div>
        <h1 style="color:white; margin-top:50px; letter-spacing:5px;">TR√âSOR PUBLIC</h1>
    </div>

    <audio id="chantOiseaux" loop><source src="oiseaux.mp3" type="audio/mpeg"></audio>

    <table class="menu-table" align="center">
        <tr>
            <td><a href="index.html">Accueil</a></td>
            <td><a href="formulaire.html">Semer üå±</a></td>
            <td><a href="jardin.html">Le Jardin üåª</a></td>
            <td><a href="regulation.html">R√©gulation ‚öñÔ∏è</a></td>
            <td><a href="urgence.html">Urgences üö®</a></td>
        </tr>
    </table>

    <div class="hero">
        <h1 style="color: #E67E22; text-shadow: 0 0 10px rgba(230,126,34,0.5);">üåü Le Tr√©sor Public üåü</h1>
        <div class="philosophie">
            "Ici, on s√®me tout ce qui est BON, on ne demande rien de pr√©cis, et on cultive la paix sans condamner."
        </div>
    </div>

    <input type="text" id="searchBox" oninput="ratisserLarge()" placeholder="üîç RATISSER LARGE : ville, pays, nom, message...">

    <div id="conteneur-vie">
        <p id="chargement">R√©cup√©ration des ondes positives du jardin... üå±</p>
    </div>

    <script>
        // 1. GESTION DE L'INTRO (2s)
        setTimeout(() => {
            const intro = document.getElementById('intro-layer');
            intro.style.opacity = '0';
            setTimeout(() => intro.style.display = 'none', 1000);
        }, 2000);

        // 2. FETCH GOOGLE SHEETS (Ton URL)
        const URL_SERVEUR = "https://script.google.com/macros/s/AKfycbz4ncs9qw_AfmKSER5QST-P0OeKQggQaq86QC6liS53uZ9sx4Lo_-4-h1knXKWqgQMc/exec";

        fetch(URL_SERVEUR)
            .then(res => res.json())
            .then(data => {
                const zone = document.getElementById('conteneur-vie');
                document.getElementById('chargement').style.display = 'none';

                data.reverse().forEach(item => {
                    if(item.type === "avis") return;

                    let couleur = "#008080";
                    if(item.type.toLowerCase().includes("urgence")) couleur = "#e91e63";
                    if(item.type.toLowerCase().includes("conflit")) couleur = "#9370DB";

                    const div = document.createElement('div');
                    div.className = 'carte';
                    div.style.borderLeftColor = couleur;
                    div.innerHTML = `
                        <b style="color:${couleur}">${item.type.toUpperCase()}</b> - ${item.date}<br>
                        <b>${item.nom}</b> (${item.localisation})<br>
                        <p style="background:#f0f0f0; padding:10px; border-radius:10px; margin-top:10px;">
                            ${item.message}
                        </p>
                    `;
                    zone.appendChild(div);
                });
            });

        // 3. MOTEUR DE RECHERCHE
        function ratisserLarge() {
            const filtre = document.getElementById('searchBox').value.toLowerCase();
            const cartes = document.getElementsByClassName('carte');
            for (let i = 0; i < cartes.length; i++) {
                const contenu = cartes[i].innerText.toLowerCase();
                cartes[i].style.display = contenu.includes(filtre) ? "block" : "none";
            }
        }

        // 4. LES PAPILLONS SVG
        function createB() {
            const b = document.createElement('div');
            b.className = 'butterfly';
            b.innerHTML = `<svg viewBox="0 0 50 50"><path class="wing" d="M25,25 Q10,0 5,20 Q5,40 25,25 Q45,40 45,20 Q40,0 25,25" /></svg>`;
            b.style.left = Math.random() * window.innerWidth + 'px';
            b.style.top = Math.random() * window.innerHeight + 'px';
            document.body.appendChild(b);
            animateB(b);
        }

        function animateB(el) {
            let x = Math.random() * window.innerWidth;
            let y = Math.random() * window.innerHeight;
            el.animate([
                { transform: `translate(0,0) rotate(0deg)` },
                { transform: `translate(${x - parseFloat(el.style.left)}px, ${y - parseFloat(el.style.top)}px) rotate(${Math.random()*360}deg)` }
            ], { duration: 6000 + Math.random()*4000 }).onfinish = () => {
                el.style.left = x + 'px'; el.style.top = y + 'px'; animateB(el);
            };
        }
        for(let i=0; i<15; i++) createB();

        // Son
        document.addEventListener('click', () => {
            const audio = document.getElementById('chantOiseaux');
            if(audio.paused) { audio.volume = 0.1; audio.play(); }
        }, {once: true});
    </script>
</body>
</html>
